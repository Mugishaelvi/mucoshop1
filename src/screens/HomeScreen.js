import React, { useState } from 'react';
import {
  View,
    Text,
      FlatList,
        TouchableOpacity,
          Image,
            StyleSheet,
              TextInput,
                ScrollView
                } from 'react-native';
                import Icon from 'react-native-vector-icons/MaterialIcons';
                import { products } from '../data/products';

                const HomeScreen = ({ navigation }) => {
                  const [searchQuery, setSearchQuery] = useState('');
                    const [cart, setCart] = useState([]);

                      const filteredProducts = products.filter(product =>
                          product.name.toLowerCase().includes(searchQuery.toLowerCase())
                            );

                              const categories = [...new Set(products.map(product => product.category))];

                                const addToCart = (product) => {
                                    setCart([...cart, product]);
                                        alert(`${product.name} ajoutÃ© au panier!`);
                                          };

                                            const renderProduct = ({ item }) => (
                                                <TouchableOpacity 
                                                      style={styles.productCard}
                                                            onPress={() => navigation.navigate('Product', { product: item })}
                                                                >
                                                                      <Image source={{ uri: item.image }} style={styles.productImage} />
                                                                            <View style={styles.productInfo}>
                                                                                    <Text style={styles.productName}>{item.name}</Text>
                                                                                            <Text style={styles.productPrice}>{item.price.toLocaleString()} FBU</Text>
                                                                                                    <TouchableOpacity 
                                                                                                              style={styles.addButton}
                                                                                                                        onPress={() => addToCart(item)}
                                                                                                                                >
                                                                                                                                          <Text style={styles.addButtonText}>Ajouter</Text>
                                                                                                                                                  </TouchableOpacity>
                                                                                                                                                        </View>
                                                                                                                                                            </TouchableOpacity>
                                                                                                                                                              );

                                                                                                                                                                return (
                                                                                                                                                                    <View style={styles.container}>
                                                                                                                                                                          {/* Header */}
                                                                                                                                                                                <View style={styles.header}>
                                                                                                                                                                                        <Text style={styles.title}>MUCO SHOP</Text>
                                                                                                                                                                                                <TouchableOpacity 
                                                                                                                                                                                                          style={styles.cartIcon}
                                                                                                                                                                                                                    onPress={() => navigation.navigate('Cart', { cart })}
                                                                                                                                                                                                                            >
                                                                                                                                                                                                                                      <Icon name="shopping-cart" size={24} color="#333" />
                                                                                                                                                                                                                                                {cart.length > 0 && (
                                                                                                                                                                                                                                                            <View style={styles.cartBadge}>
                                                                                                                                                                                                                                                                          <Text style={styles.cartBadgeText}>{cart.length}</Text>
                                                                                                                                                                                                                                                                                      </View>
                                                                                                                                                                                                                                                                                                )}
                                                                                                                                                                                                                                                                                                        </TouchableOpacity>
                                                                                                                                                                                                                                                                                                              </View>

                                                                                                                                                                                                                                                                                                                    {/* Search Bar */}
                                                                                                                                                                                                                                                                                                                          <View style={styles.searchContainer}>
                                                                                                                                                                                                                                                                                                                                  <TextInput
                                                                                                                                                                                                                                                                                                                                            style={styles.searchInput}
                                                                                                                                                                                                                                                                                                                                                      placeholder="Rechercher un produit..."
                                                                                                                                                                                                                                                                                                                                                                value={searchQuery}
                                                                                                                                                                                                                                                                                                                                                                          onChangeText={setSearchQuery}
                                                                                                                                                                                                                                                                                                                                                                                  />
                                                                                                                                                                                                                                                                                                                                                                                          <Icon name="search" size={20} color="#666" style={styles.searchIcon} />
                                                                                                                                                                                                                                                                                                                                                                                                </View>

                                                                                                                                                                                                                                                                                                                                                                                                      {/* Categories */}
                                                                                                                                                                                                                                                                                                                                                                                                            <ScrollView 
                                                                                                                                                                                                                                                                                                                                                                                                                    horizontal 
                                                                                                                                                                                                                                                                                                                                                                                                                            showsHorizontalScrollIndicator={false}
                                                                                                                                                                                                                                                                                                                                                                                                                                    style={styles.categoriesContainer}
                                                                                                                                                                                                                                                                                                                                                                                                                                          >
                                                                                                                                                                                                                                                                                                                                                                                                                                                  {categories.map((category, index) => (
                                                                                                                                                                                                                                                                                                                                                                                                                                                            <TouchableOpacity key={index} style={styles.categoryChip}>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <Text style={styles.categoryText}>{category}</Text>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </TouchableOpacity>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ))}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </ScrollView>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      {/* Products Grid */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <FlatList
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    data={filteredProducts}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            renderItem={renderProduct}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    keyExtractor={item => item.id.toString()}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            numColumns={2}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    contentContainerStyle={styles.productsGrid}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            showsVerticalScrollIndicator={false}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </View>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const styles = StyleSheet.create({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          container: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              flex: 1,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  backgroundColor: '#f5f5f5',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      padding: 10,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          header: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              flexDirection: 'row',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  justifyContent: 'space-between',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      alignItems: 'center',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          marginBottom: 15,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              title: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  fontSize: 24,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      fontWeight: 'bold',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          color: '#333',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              cartIcon: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  padding: 5,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      position: 'relative',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          cartBadge: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              position: 'absolute',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  top: -5,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      right: -5,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          backgroundColor: '#ff4444',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              borderRadius: 10,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  minWidth: 20,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      height: 20,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          justifyContent: 'center',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              alignItems: 'center',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  cartBadgeText: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      color: 'white',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          fontSize: 12,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              fontWeight: 'bold',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  searchContainer: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      position: 'relative',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          marginBottom: 15,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              searchInput: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  backgroundColor: 'white',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      paddingHorizontal: 15,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          paddingVertical: 12,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              borderRadius: 25,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  borderWidth: 1,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      borderColor: '#ddd',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          paddingLeft: 45,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              searchIcon: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  position: 'absolute',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      left: 15,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          top: 12,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              categoriesContainer: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  marginBottom: 15,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      categoryChip: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          backgroundColor: 'white',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              paddingHorizontal: 20,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  paddingVertical: 10,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      borderRadius: 20,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          marginRight: 10,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              borderWidth: 1,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  borderColor: '#ddd',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      categoryText: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          color: '#333',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              fontWeight: '500',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  productsGrid: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      paddingBottom: 20,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          productCard: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              flex: 1,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  backgroundColor: 'white',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      margin: 5,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          borderRadius: 10,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              padding: 10,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  shadowColor: '#000',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      shadowOffset: { width: 0, height: 2 },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          shadowOpacity: 0.1,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              shadowRadius: 4,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  elevation: 3,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      productImage: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          width: '100%',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              height: 120,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  borderRadius: 8,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      marginBottom: 8,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          productInfo: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              paddingHorizontal: 5,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  productName: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      fontSize: 14,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          fontWeight: '600',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              marginBottom: 4,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  productPrice: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      fontSize: 16,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          fontWeight: 'bold',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              color: '#007bff',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  marginBottom: 8,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      addButton: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          backgroundColor: '#007bff',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              paddingVertical: 6,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  borderRadius: 5,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      alignItems: 'center',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          addButtonText: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              color: 'white',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  fontWeight: 'bold',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      fontSize: 12,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        export default HomeScreen;
